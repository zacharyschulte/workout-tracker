<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="IRON">
    <meta name="application-name" content="IRON">
    <meta name="description" content="Workout tracker with templates, 1RM calculator, and progressive overload planning">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <title>IRON ‚Äî Workout Tracker</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiSVJPTiBXb3Jrb3V0IFRyYWNrZXIiLCJzaG9ydF9uYW1lIjoiSVJPTiIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMGEwYTBhIiwidGhlbWVfY29sb3IiOiIjMGEwYTBhIiwib3JpZW50YXRpb24iOiJwb3J0cmFpdCIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDE5MiAxOTInJTNFJTNDcmVjdCBmaWxsPSclMjMwYTBhMGEnIHdpZHRoPScxOTInIGhlaWdodD0nMTkyJy8lM0UlM0N0ZXh0IHg9Jzk2JyB5PScxMjAnIGZvbnQtc2l6ZT0nODAnIGZvbnQtZmFtaWx5PSdzYW5zLXNlcmlmJyBmb250LXdlaWdodD0nYm9sZCcgZmlsbD0nJTIzZmYzYjMwJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyUzRUZFJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect fill='%230a0a0a' width='32' height='32' rx='6'/%3E%3Ctext x='16' y='22' font-size='16' font-family='sans-serif' font-weight='bold' fill='%23ff3b30' text-anchor='middle'%3EFE%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect fill='%230a0a0a' width='180' height='180'/%3E%3Ctext x='90' y='115' font-size='72' font-family='sans-serif' font-weight='bold' fill='%23ff3b30' text-anchor='middle'%3EFE%3C/text%3E%3C/svg%3E">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app">
        <header>
            <div class="logo">IRON</div>
            <button type="button" class="icon-btn" id="settings-btn" aria-label="Settings">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"></path>
                </svg>
            </button>
        </header>

        <main>
            <!-- Tab: Workout -->
            <div class="tab-content active" id="tab-workout">
                <div id="workout-view">
                    <div class="active-workout" id="active-workout" style="display: none;">
                        <div class="workout-header">
                            <span class="workout-name" id="active-workout-name">Workout</span>
                            <span class="workout-timer" id="workout-timer">00:00</span>
                        </div>
                        <div id="active-exercises"></div>
                        <div style="margin-top: 16px;">
                            <label class="form-label" style="margin-bottom: 6px; display: block;">Notes (optional)</label>
                            <textarea class="form-input" id="workout-notes" placeholder="How did you feel? Any observations?" rows="3" style="resize: vertical; min-height: 60px;"></textarea>
                        </div>
                        <div class="workout-actions" style="margin-top: 16px; padding-bottom: 20px;">
                            <button type="button" class="btn btn-success" id="finish-btn" style="margin-bottom: 8px;">‚úì Finish Workout</button>
                            <button type="button" class="btn btn-secondary" id="cancel-btn">Cancel</button>
                        </div>
                    </div>

                    <div id="template-view">
                        <h2 class="section-title">Start Workout</h2>
                        <div id="template-list"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Progress (v4 Combined) -->
            <div class="tab-content" id="tab-calc">
                <h2 class="section-title">Progress</h2>

                <!-- Exercise Selector -->
                <div class="form-group">
                    <label class="form-label">Exercise</label>
                    <select class="form-input" id="progress-exercise-select">
                        <!-- Populated by JS -->
                    </select>
                </div>

                <!-- Your Stats -->
                <div class="calc-section" id="progress-stats-section">
                    <h3 class="calc-title">Your Stats</h3>
                    <div class="calc-results" style="grid-template-columns: repeat(3, 1fr);">
                        <div class="calc-result">
                            <div class="calc-result-value" id="progress-1rm">‚Äî</div>
                            <div class="calc-result-label">Est. 1RM</div>
                        </div>
                        <div class="calc-result">
                            <div class="calc-result-value" id="progress-working">‚Äî</div>
                            <div class="calc-result-label">Working</div>
                        </div>
                        <div class="calc-result">
                            <div class="calc-result-value" id="progress-trend">‚Üí</div>
                            <div class="calc-result-label">Trend</div>
                        </div>
                    </div>

                    <!-- Strength Level -->
                    <div id="progress-level-display" style="margin-top: 16px;">
                        <div class="form-label" style="margin-bottom: 8px;">Level</div>
                        <div class="standards-bar">
                            <div class="standards-segment beginner"></div>
                            <div class="standards-segment novice"></div>
                            <div class="standards-segment intermediate"></div>
                            <div class="standards-segment advanced"></div>
                            <div class="standards-segment elite"></div>
                            <div class="standards-marker" id="progress-marker"></div>
                        </div>
                        <div class="standards-labels">
                            <span>Beg</span><span>Nov</span><span>Int</span><span>Adv</span><span>Elite</span>
                        </div>
                        <div id="progress-level-info" style="margin-top: 10px; font-size: 12px; color: var(--text-muted);"></div>
                    </div>
                </div>

                <!-- Calculate from Lift -->
                <div class="calc-section">
                    <h3 class="calc-title">Calculate from Lift</h3>
                    <div class="form-row">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Weight (lbs)</label>
                            <input type="number" inputmode="decimal" class="form-input" id="progress-calc-weight" placeholder="135" min="0" max="1500" step="0.5">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Reps</label>
                            <input type="number" inputmode="numeric" class="form-input" id="progress-calc-reps" placeholder="8" min="1" max="100" step="1">
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" id="progress-update-btn" style="margin-top: 12px; width: 100%;">Update 1RM & Working Weight</button>
                </div>

                <!-- Standards Table -->
                <div class="calc-section" id="progress-standards-section" style="display: none;">
                    <h3 class="calc-title">Strength Standards</h3>
                    <div id="progress-standards-table"></div>
                </div>

                <!-- Goal Suggestions -->
                <div id="progress-goal-suggestions" class="goal-suggestions" style="display: none;">
                    <span class="planner-label">Suggested Goals</span>
                    <div class="goal-chips" id="progress-goal-chips">
                        <!-- Goal suggestions rendered here -->
                    </div>
                </div>

                <!-- Plan Progression -->
                <div class="calc-section" id="progress-plan-section">
                    <h3 class="calc-title">Plan Progression</h3>
                    <div class="planner-config">
                        <div class="planner-field">
                            <span class="planner-label">Current</span>
                            <input type="number" inputmode="decimal" class="planner-input" id="progress-plan-current" placeholder="135" min="0" max="1500" step="2.5">
                        </div>
                        <div class="planner-field">
                            <span class="planner-label">Goal</span>
                            <input type="number" inputmode="decimal" class="planner-input" id="progress-plan-goal" placeholder="185" min="0" max="1500" step="2.5">
                        </div>
                    </div>
                    <div class="form-row" style="margin-top: 12px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Frequency</label>
                            <select class="form-input" id="progress-plan-frequency">
                                <option value="1">1√ó/week</option>
                                <option value="2" selected>2√ó/week</option>
                                <option value="3">3√ó/week</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Increment</label>
                            <input type="number" inputmode="decimal" class="form-input" id="progress-plan-increment" placeholder="5" min="0" max="50" step="2.5" value="5">
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary" id="progress-generate-plan-btn" style="margin-top: 12px; width: 100%;">Generate Plan</button>

                    <!-- Active Plan Display -->
                    <div id="progress-active-plan" style="display: none; margin-top: 16px; padding: 14px; background: var(--bg); border-radius: 10px; border: 1px solid var(--border);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <strong id="progress-plan-name">Plan Name</strong>
                            <button type="button" class="btn-text" id="progress-cancel-plan" style="color: var(--text-muted); font-size: 11px;">√ó</button>
                        </div>
                        <div id="progress-plan-progress" style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;"></div>
                        <div style="width: 100%; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                            <div id="progress-plan-bar" style="height: 100%; background: var(--accent); transition: width 0.3s;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Progress Planner -->
            <div class="tab-content" id="tab-progress">
                <div class="calc-section">
                    <h3 class="calc-title">Progressive Overload Planner</h3>
                    <p style="font-size: 11px; color: var(--text-muted); margin-bottom: 12px;">Plan your working weight progression</p>

                    <div class="form-group">
                        <label class="form-label">Exercise</label>
                        <select class="form-input" id="plan-exercise" onchange="loadExerciseData()">
                            <option value="bench">Bench Press</option>
                            <option value="squat">Back Squat</option>
                            <option value="deadlift">Deadlift</option>
                            <option value="ohp">Overhead Press</option>
                            <option value="row">Barbell Row</option>
                            <option value="front-squat">Front Squat</option>
                        </select>
                    </div>

                    <div id="current-stats" class="current-stats" style="display: none;">
                        <div class="current-stats-label">From your saved estimate:</div>
                        <div class="current-stats-row">
                            <div class="current-stat">
                                <div class="current-stat-value" id="plan-current-1rm">‚Äî</div>
                                <div class="current-stat-label">Est. 1RM</div>
                            </div>
                            <div class="current-stat highlight">
                                <div class="current-stat-value" id="plan-current-working">‚Äî</div>
                                <div class="current-stat-label">You Lifted</div>
                            </div>
                        </div>
                    </div>

                    <div id="no-estimate-warning" class="warning-box" style="display: none;">
                        <span>‚ö†Ô∏è</span>
                        <div>
                            <strong>No saved estimate</strong><br>
                            <span style="font-size: 11px;">Go to the 1RM tab to calculate and save your current max, or enter manually below.</span>
                        </div>
                    </div>

                    <div class="planner-config">
                        <div class="planner-field">
                            <span class="planner-label">Current Working Weight</span>
                            <input type="number" inputmode="decimal" class="planner-input" id="plan-current" placeholder="130" min="0" max="1500" step="2.5">
                        </div>
                        <div class="planner-field">
                            <span class="planner-label">Goal Working Weight</span>
                            <input type="number" inputmode="decimal" class="planner-input" id="plan-goal" placeholder="185" min="0" max="1500" step="2.5">
                        </div>
                    </div>

                    <div id="goal-suggestions" class="goal-suggestions" style="display: none;">
                        <span class="planner-label">Suggested Goals</span>
                        <div class="goal-chips" id="goal-chips">
                            <!-- Goal suggestions rendered here -->
                        </div>
                    </div>

                    <div class="planner-config" style="margin-top: 14px;">
                        <div class="planner-field">
                            <span class="planner-label">Workouts/Week</span>
                            <select class="planner-input" id="plan-frequency">
                                <option value="1">1√ó/week</option>
                                <option value="2" selected>2√ó/week</option>
                                <option value="3">3√ó/week</option>
                            </select>
                        </div>
                        <div class="planner-field">
                            <span class="planner-label">Weekly Increase</span>
                            <select class="planner-input" id="plan-increment">
                                <option value="2.5">2.5 lbs</option>
                                <option value="5" selected>5 lbs</option>
                                <option value="10">10 lbs</option>
                            </select>
                        </div>
                    </div>

                    <button type="button" class="btn btn-primary" id="generate-plan-btn">Generate Plan</button>

                    <div class="progress-timeline" id="progress-timeline" style="display: none;"></div>
                </div>

                <div id="saved-plans-section">
                    <h2 class="section-title" style="margin-top: 20px;">Saved Plans</h2>
                    <div id="saved-plans-list"></div>
                </div>
            </div>

            <!-- Tab: History -->
            <div class="tab-content" id="tab-history">
                <h2 class="section-title">Workout History</h2>
                <div id="history-list"></div>
            </div>

            <!-- Tab: Settings -->
            <div class="tab-content" id="tab-settings">
                <h2 class="section-title">Settings</h2>

                <!-- Profile Settings -->
                <div class="card">
                    <div class="card-title">Profile</div>
                    <div class="form-row" style="margin-top: 12px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Body Weight (lbs)</label>
                            <input type="number" inputmode="decimal" class="form-input" id="profile-weight" placeholder="180" min="50" max="500" step="0.1">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Sex</label>
                            <select class="form-input" id="profile-sex">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" id="save-profile-btn" style="margin-top: 12px; width: 100%;">Save Profile</button>
                </div>

                <!-- Data Management -->
                <div class="card">
                    <div class="card-title">Data Management</div>
                    <button type="button" class="btn btn-secondary" id="export-btn" style="margin-top: 10px; width: 100%;">Export All Data</button>
                    <button type="button" class="btn btn-secondary" id="import-btn" style="margin-top: 8px; width: 100%;">Import Data</button>
                    <button type="button" class="btn btn-danger" id="clear-btn" style="margin-top: 8px; width: 100%;">Clear All Data</button>
                </div>

                <!-- About -->
                <div class="card">
                    <div class="card-title">About</div>
                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 8px; line-height: 1.6;">
                        <strong style="color: var(--text);">IRON v4.0</strong><br>
                        Lightweight workout tracker with smart features.<br>
                        <br>
                        ‚Ä¢ 40+ exercises<br>
                        ‚Ä¢ PR detection<br>
                        ‚Ä¢ Progress tracking<br>
                        ‚Ä¢ Offline support
                    </div>
                </div>

                <input type="file" id="import-input" accept=".json" style="display: none;">
            </div>
        </main>

        <nav class="bottom-nav" role="navigation" aria-label="Main navigation">
            <button type="button" class="nav-item active" data-tab="workout" aria-label="Workout tab" aria-selected="true">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M6.5 6.5h11M6.5 17.5h11M4 12h16M2 6.5a2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5v11a2.5 2.5 0 0 1-2.5 2.5 2.5 2.5 0 0 1-2.5-2.5zM17 6.5a2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5v11a2.5 2.5 0 0 1-2.5 2.5 2.5 2.5 0 0 1-2.5-2.5z"></path>
                </svg>
                Workout
            </button>
            <button type="button" class="nav-item" data-tab="calc" aria-label="Progress tab">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                    <polyline points="17 6 23 6 23 12"></polyline>
                </svg>
                Progress
            </button>
            <button type="button" class="nav-item" data-tab="history" aria-label="History tab">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                History
            </button>
            <button type="button" class="nav-item" data-tab="settings" aria-label="Settings tab">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"></path>
                </svg>
                ‚öôÔ∏è
            </button>
        </nav>

        <button type="button" class="fab" id="fab-btn" aria-label="Create new template">+</button>
    </div>

    <!-- Template Modal -->
    <div class="modal-overlay" id="template-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="template-modal-title">New Template</h3>
                <button type="button" class="close-btn" id="close-template-modal" aria-label="Close modal">√ó</button>
            </div>
            <form id="template-form" onsubmit="return false;" autocomplete="off">
                <div class="form-group">
                    <label class="form-label">Template Name</label>
                    <input type="text" class="form-input" id="template-name" placeholder="e.g., Push Day, Leg Day..." required>
                </div>

                <!-- Exercise Picker Section -->
                <div class="form-group" id="exercise-picker-section">
                    <label class="form-label">Add Exercises</label>
                    <input type="text" class="form-input" id="exercise-search" placeholder="üîç Search exercises..." style="margin-bottom: 12px;">

                    <div id="exercise-categories" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; padding: 8px;">
                        <!-- Categories will be populated by JS -->
                    </div>

                    <button type="button" class="btn btn-secondary" id="create-custom-exercise-btn" style="margin-top: 8px; width: 100%;">+ Create Custom Exercise</button>
                </div>

                <!-- Added Exercises -->
                <div class="form-group">
                    <label class="form-label">Template Exercises</label>
                    <div id="template-exercises"></div>
                </div>

                <input type="hidden" id="editing-template-id">
                <button type="submit" class="btn btn-primary">Save Template</button>
                <button type="button" class="btn btn-danger" id="delete-template-btn" style="margin-top: 8px; display: none;">Delete Template</button>
            </form>
        </div>
    </div>

    <!-- Custom Exercise Modal -->
    <div class="modal-overlay" id="custom-exercise-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Create Custom Exercise</h3>
                <button type="button" class="close-btn" id="close-custom-exercise-modal" aria-label="Close modal">√ó</button>
            </div>
            <form id="custom-exercise-form" onsubmit="return false;" autocomplete="off">
                <div class="form-group">
                    <label class="form-label">Exercise Name</label>
                    <input type="text" class="form-input" id="custom-exercise-name" placeholder="e.g., Hack Squat" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-input" id="custom-exercise-category">
                        <option value="strength">Strength</option>
                        <option value="cardio">Cardio</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Equipment</label>
                    <select class="form-input" id="custom-exercise-equipment">
                        <option value="barbell">Barbell</option>
                        <option value="dumbbell">Dumbbell</option>
                        <option value="kettlebell">Kettlebell</option>
                        <option value="cable">Cable</option>
                        <option value="machine">Machine</option>
                        <option value="bodyweight">Bodyweight</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Muscle Group</label>
                    <select class="form-input" id="custom-exercise-muscle">
                        <option value="chest">Chest</option>
                        <option value="back">Back</option>
                        <option value="shoulders">Shoulders</option>
                        <option value="arms">Arms</option>
                        <option value="legs">Legs</option>
                        <option value="core">Core</option>
                        <option value="fullbody">Full Body</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Create Exercise</button>
            </form>
        </div>
    </div>

    <!-- View Workout Modal -->
    <div class="modal-overlay" id="workout-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="workout-modal-title">Workout</h3>
                <button type="button" class="close-btn" id="close-workout-modal" aria-label="Close modal">√ó</button>
            </div>
            <p id="workout-modal-date" style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px;"></p>
            <div id="workout-modal-exercises"></div>
            <button type="button" class="btn btn-danger" id="delete-workout-btn" style="margin-top: 14px;">Delete Workout</button>
        </div>
    </div>

    <!-- Save Plan Modal -->
    <div class="modal-overlay" id="plan-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Save Plan</h3>
                <button type="button" class="close-btn" id="close-plan-modal" aria-label="Close modal">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">Plan Name</label>
                <input type="text" class="form-input" id="plan-name" placeholder="e.g., Bench to 225">
            </div>
            <button type="button" class="btn btn-primary" id="confirm-save-plan">Save Plan</button>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay" id="confirm-modal">
        <div class="modal" style="max-width: 320px; text-align: center;">
            <h3 class="modal-title" id="confirm-title">Confirm</h3>
            <p id="confirm-message" style="color: var(--text-muted); margin: 16px 0; font-size: 14px;"></p>
            <div style="display: flex; gap: 10px;">
                <button type="button" class="btn btn-secondary" id="confirm-no" style="flex: 1;">No</button>
                <button type="button" class="btn btn-danger" id="confirm-yes" style="flex: 1; background: var(--accent); color: white;">Yes</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
